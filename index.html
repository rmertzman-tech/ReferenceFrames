<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reference Frames: Interactive Learning Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #7c3aed;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--bg-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* Navigation */
        nav {
            background: var(--bg-white);
            padding: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: sticky;
            top: 120px;
            z-index: 90;
        }

        .nav-container {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            padding: 0.6rem 1.2rem;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Progress Bar */
        .progress-container {
            background: white;
            padding: 1rem;
            margin: 2rem 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-gray);
            text-align: center;
        }

        /* Main Content */
        main {
            padding: 2rem 0;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .card h3 {
            color: var(--secondary);
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
        }

        .card p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .card ul, .card ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .card li {
            margin-bottom: 0.5rem;
        }

        /* Interactive Elements */
        .interactive-box {
            background: var(--bg-light);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .interactive-box h4 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .example-box {
            background: #f0f9ff;
            border-left: 4px solid var(--success);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .example-box h4 {
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .warning-box h4 {
            color: var(--warning);
            margin-bottom: 0.5rem;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        /* Quiz Styles */
        .quiz-question {
            margin: 2rem 0;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .quiz-option {
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            border-color: var(--primary);
            background: var(--bg-light);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: #f0fdf4;
        }

        .quiz-option.incorrect {
            border-color: var(--danger);
            background: #fef2f2;
        }

        .quiz-feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background: #f0fdf4;
            border: 2px solid var(--success);
            color: var(--success);
        }

        .quiz-feedback.incorrect {
            background: #fef2f2;
            border: 2px solid var(--danger);
            color: var(--danger);
        }

        /* Scale Visualizer */
        .scale-viz {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 2rem 0;
        }

        .scale-level {
            padding: 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .scale-level:hover {
            transform: translateX(10px);
            border-color: var(--primary);
        }

        .scale-level.bio {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .scale-level.neural {
            background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
        }

        .scale-level.personal {
            background: linear-gradient(135deg, #bfdbfe 0%, #93c5fd 100%);
        }

        .scale-level.social {
            background: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 100%);
        }

        .scale-level h4 {
            margin-bottom: 0.5rem;
        }

        .scale-detail {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid rgba(0,0,0,0.1);
        }

        .scale-level.expanded .scale-detail {
            display: block;
        }

        /* Frame Exercise */
        .frame-exercise {
            margin: 2rem 0;
        }

        .frame-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            margin: 1rem 0;
            font-family: inherit;
        }

        .frame-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea.frame-input {
            min-height: 100px;
            resize: vertical;
        }

        /* Slider */
        .slider-container {
            margin: 2rem 0;
        }

        .slider {
            width: 100%;
            margin: 1rem 0;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        .slider-value {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-top: 0.5rem;
        }

        /* Application Cards */
        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .app-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .app-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-4px);
        }

        .app-card h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .app-card .icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        /* Action Plan */
        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            margin: 1rem 0;
            background: var(--bg-light);
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .action-checkbox {
            margin-top: 0.2rem;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .action-text {
            flex: 1;
        }

        .action-text.completed {
            text-decoration: line-through;
            opacity: 0.6;
        }

        /* Resources */
        .resource-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 8px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: var(--bg-white);
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
        }

        .close {
            color: white;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: transform 0.2s;
        }

        .close:hover {
            transform: scale(1.2);
        }

        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
        }

        /* PDF Viewer */
        .pdf-viewer-container {
            width: 100%;
            height: 70vh;
            border: 2px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .pdf-viewer-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Assignment Card */
        .assignment-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin: 2rem 0;
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .assignment-card h3 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
        }

        .assignment-checklist {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem;
            margin: 0.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .checklist-icon {
            font-size: 1.5rem;
            min-width: 30px;
        }

        .submission-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .submission-btn {
            padding: 1rem;
            background: white;
            color: var(--primary);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .submission-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .submission-btn .icon {
            font-size: 2rem;
        }

        /* Copy Notification */
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            z-index: 1001;
            animation: slideIn 0.3s;
        }

        .copy-notification.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        .tab {
            padding: 0.8rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-gray);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        /* Resource Grid */
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .resource-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }

        .resource-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .resource-card h4 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .resource-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .resource-card p {
            color: var(--text-gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .resource-card .btn {
            width: 100%;
        }

        /* Footer */
        footer {
            background: var(--text-dark);
            color: white;
            padding: 2rem 0;
            margin-top: 4rem;
            text-align: center;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.5rem;
            }

            nav {
                top: 100px;
            }

            .nav-container {
                justify-content: flex-start;
                overflow-x: auto;
            }

            .card {
                padding: 1.5rem;
            }

            .app-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Floating Button */
        .floating-export {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
        }

        .floating-export .btn {
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
    </style>
</head>
<body>
    <!-- Copy Notification -->
    <div id="copyNotification" class="copy-notification">
        ‚úì Copied to clipboard! Ready to paste.
    </div>

    <header>
        <div class="container">
            <h1>üîç Reference Frames: Interactive Learning Journey</h1>
            <p>From Personal Meaning to Global Transformation</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-container" id="navigation">
                <!-- Navigation buttons will be inserted here -->
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">Get started to begin your journey</div>
        </div>

        <main id="mainContent">
            <!-- Content sections will be inserted here -->
        </main>
    </div>

    <!-- PDF Modal -->
    <div id="pdfModal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h3>üìñ Reference Frames: Complete Essay (PDF)</h3>
                <span class="close" onclick="closeModal('pdfModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="pdf-viewer-container">
                    <iframe id="pdfViewer" src=""></iframe>
                </div>
                <div style="text-align: center; margin-top: 1rem;">
                    <p style="margin-bottom: 1rem;">Having trouble viewing? <a href="#" onclick="downloadPDF(); return false;" style="color: var(--primary);">Download PDF instead</a></p>
                    <button class="btn btn-primary" onclick="downloadPDF()">
                        üì• Download PDF Essay
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìã Export Your Assignment Work</h3>
                <span class="close" onclick="closeModal('exportModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 3px solid var(--primary); padding: 2rem; border-radius: 12px; margin: 2rem 0;">
                    <h4>üìù Assignment Submission Options</h4>
                    <p>Choose how you want to submit your work to your instructor:</p>
                    
                    <div style="display: grid; gap: 1rem; margin: 1.5rem 0;">
                        <button class="btn btn-primary" onclick="exportFormatted()">
                            üìÑ Copy Formatted Text (Paste into Email/LMS)
                        </button>
                        <button class="btn btn-secondary" onclick="exportDocument()">
                            üíæ Download Text Document
                        </button>
                        <button class="btn btn-outline" onclick="exportJSON()">
                            üîß Download Data Backup (JSON)
                        </button>
                    </div>
                </div>

                <div style="background: #fef3c7; border-left: 4px solid var(--warning); padding: 1.5rem; margin: 1.5rem 0; border-radius: 8px;">
                    <h4 style="color: var(--warning); margin-bottom: 0.5rem;">‚ö†Ô∏è Before You Export:</h4>
                    <ul>
                        <li>Complete all required sections (8/8)</li>
                        <li>Review your self-assessments for accuracy</li>
                        <li>Check that your reflections are thoughtful and complete</li>
                        <li>Make sure you've selected your practice commitment</li>
                    </ul>
                </div>

                <div id="exportPreview" style="display: none; margin-top: 2rem;">
                    <h4>Preview of Your Submission:</h4>
                    <div style="background: white; padding: 1rem; border-radius: 8px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 0.9rem; border: 1px solid var(--border);">
                        <pre id="previewContent" style="white-space: pre-wrap; word-wrap: break-word; margin: 0;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Export Button -->
    <div class="floating-export">
        <button class="btn btn-primary" onclick="showExportModal()" title="Export Your Work">
            üìã
        </button>
    </div>

    <footer>
        <div class="container">
            <p>Reference Frames Learning Platform | Educational Assignment Tool</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem; opacity: 0.8;">
                Based on "Reference Frames: A Unified Lens for Understanding and Transforming Human Systems"
            </p>
        </div>
    </footer>

    <script>
        // ============================================
        // PDF CONFIGURATION
        // ============================================
        // Place your PDF file named "Reference_Frames_Essay.pdf" in the same folder as this HTML file
        const PDF_FILE_PATH = 'Reference_Frames_Essay.pdf';
        
        // Application State
        const state = {
            currentSection: 0,
            completedSections: new Set(),
            quizScores: {},
            userNotes: {},
            actionPlan: []
        };

        // Section Definitions
        const sections = [
            { id: 'intro', title: 'Introduction', shortTitle: 'Start', content: generateIntroSection },
            { id: 'what-are-frames', title: 'What Are Reference Frames?', shortTitle: 'Basics', content: generateBasicsSection },
            { id: 'scales', title: 'The Scale Hierarchy', shortTitle: 'Scales', content: generateScalesSection },
            { id: 'meta-constructor', title: 'Meta-Constructor Capacity', shortTitle: 'Meta-Constructor', content: generateMetaConstructorSection },
            { id: 'atcf', title: 'Temporal Coherence (ATCF)', shortTitle: 'ATCF', content: generateATCFSection },
            { id: 'applications', title: 'Real-World Applications', shortTitle: 'Applications', content: generateApplicationsSection },
            { id: 'personal-practice', title: 'Personal Practice', shortTitle: 'Practice', content: generatePracticeSection },
            { id: 'action-plan', title: 'Assignment Submission', shortTitle: 'Submit', content: generateActionPlanSection }
        ];

        // Initialize App
        function initApp() {
            generateNavigation();
            loadAllSections();
            loadState();
            showSection(0);
            updateProgress();
        }

        // Generate Navigation
        function generateNavigation() {
            const nav = document.getElementById('navigation');
            sections.forEach((section, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.textContent = section.shortTitle;
                btn.onclick = () => showSection(index);
                btn.id = `nav-${index}`;
                nav.appendChild(btn);
            });
        }

        // Load All Sections
        function loadAllSections() {
            const main = document.getElementById('mainContent');
            sections.forEach((section, index) => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section';
                sectionDiv.id = `section-${index}`;
                sectionDiv.innerHTML = section.content(index);
                main.appendChild(sectionDiv);
            });
        }

        // Show Section
        function showSection(index) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(`section-${index}`).classList.add('active');
            document.getElementById(`nav-${index}`).classList.add('active');
            
            state.currentSection = index;
            updateProgress();
            saveState();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Update Progress
        function updateProgress() {
            const progressPercent = (state.completedSections.size / sections.length) * 100;
            document.getElementById('progressBar').style.width = `${progressPercent}%`;
            document.getElementById('progressText').textContent = 
                `${state.completedSections.size} of ${sections.length} sections completed (${Math.round(progressPercent)}%)`;
        }

        // Mark Section Complete
        function markComplete(sectionIndex) {
            state.completedSections.add(sectionIndex);
            updateProgress();
            saveState();
            
            if (state.completedSections.size === sections.length) {
                alert('üéâ Congratulations! You\'ve completed the entire learning journey!');
            }
        }

        // Save State
        function saveState() {
            localStorage.setItem('referenceFramesState', JSON.stringify({
                completedSections: Array.from(state.completedSections),
                quizScores: state.quizScores,
                userNotes: state.userNotes,
                actionPlan: state.actionPlan
            }));
        }

        // Load State
        function loadState() {
            const saved = localStorage.getItem('referenceFramesState');
            if (saved) {
                const parsed = JSON.parse(saved);
                state.completedSections = new Set(parsed.completedSections || []);
                state.quizScores = parsed.quizScores || {};
                state.userNotes = parsed.userNotes || {};
                state.actionPlan = parsed.actionPlan || [];
            }
        }

        // ============================================
        // SECTION CONTENT GENERATORS
        // ============================================

        function generateIntroSection(index) {
            return `
                <div class="card">
                    <h2>Welcome to Reference Frames</h2>
                    <p style="font-size: 1.1rem; color: var(--secondary); font-weight: 600;">
                        A Unified Lens for Understanding and Transforming Human Systems
                    </p>
                    
                    <div class="interactive-box">
                        <h4>üéØ What You'll Learn</h4>
                        <p>This interactive journey will teach you:</p>
                        <ul>
                            <li><strong>What reference frames are</strong> and why they matter for everything from personal meaning to global crises</li>
                            <li><strong>How frames operate across scales</strong> from cells to civilizations</li>
                            <li><strong>Meta-constructor capacity</strong>‚Äîyour ability to examine and modify your own frames</li>
                            <li><strong>Temporal coherence (ATCF)</strong>‚Äîmaintaining identity across time and change</li>
                            <li><strong>Applications to real challenges</strong>‚Äîinequality, discrimination, existential risks, meaningful living</li>
                            <li><strong>Practical tools</strong> for daily frame work and personal development</li>
                        </ul>
                    </div>

                    <h3>Why Reference Frames Matter</h3>
                    <p>
                        Every observation requires a perspective. Every measurement needs units. Every judgment assumes standards. 
                        Every action depends on what counts as "the same" across contexts.
                    </p>
                    <p>
                        These are <strong>reference frames</strong>‚Äîthe operational structures that make information meaningful 
                        and action possible. They're so fundamental we rarely notice them, like the air we breathe.
                    </p>

                    <div class="example-box">
                        <h4>üí° Quick Example</h4>
                        <p>Consider this situation: <em>"Someone raises their voice at you."</em></p>
                        <p><strong>Different reference frames create different experiences:</strong></p>
                        <ul>
                            <li><strong>Threat frame:</strong> "Danger! I'm being attacked. Fight or flee."</li>
                            <li><strong>Challenge frame:</strong> "They're passionate about this. We're having an intense debate."</li>
                            <li><strong>Cultural frame:</strong> "In their culture, this is normal emphasis, not anger."</li>
                            <li><strong>Medical frame:</strong> "They're having a neurological episode. Call for help."</li>
                        </ul>
                        <p><em>Same physical event. Completely different meanings, emotions, and responses depending on your frame.</em></p>
                    </div>

                    <h3>The Promise</h3>
                    <p>
                        Understanding reference frames provides a unified leverage point for addressing challenges from 
                        personal meaning to global catastrophe. Whether you're:
                    </p>
                    <ul>
                        <li>Struggling with internal conflict or life direction</li>
                        <li>Navigating difficult relationships or social dynamics</li>
                        <li>Working on education, therapy, or organizational change</li>
                        <li>Thinking about inequality, conflict, or existential risks</li>
                    </ul>
                    <p>
                        ...the same fundamental patterns apply. <strong>Reference frames are how we make meaning, 
                        coordinate action, and either flourish or fragment.</strong>
                    </p>

                    <div class="warning-box">
                        <h4>‚ö†Ô∏è This Isn't Just Theory</h4>
                        <p>
                            This framework is grounded in empirical science (neuroscience, bioelectricity, psychology) 
                            and 2,500 years of philosophical wisdom. But more importantly: 
                            <strong>it's immediately practical.</strong>
                        </p>
                        <p>
                            You'll gain tools you can use today to understand yourself better, navigate challenges more 
                            effectively, and contribute to systemic change.
                        </p>
                    </div>

                    <h3>How to Use This Platform</h3>
                    <p><strong>This is an interactive learning journey:</strong></p>
                    <ol>
                        <li><strong>Progress sequentially</strong> through sections using the navigation above</li>
                        <li><strong>Engage with exercises</strong>‚Äîthey're not optional, they're where real learning happens</li>
                        <li><strong>Take your time</strong>‚Äîthis is deep material that builds progressively</li>
                        <li><strong>Revisit sections</strong>‚Äîconcepts become clearer with repeated exposure</li>
                        <li><strong>Apply immediately</strong>‚Äîtry ideas in your daily life as you learn them</li>
                    </ol>

                    <div class="example-box">
                        <h4>üìñ Complete Essay Available</h4>
                        <p>Want to read the full essay that this learning journey is based on?</p>
                        <button class="btn btn-primary" onclick="viewPDF()" style="margin-top: 0.5rem;">
                            Read Full Essay (PDF)
                        </button>
                    </div>

                    <div class="interactive-box">
                        <h4>‚úÖ Ready to Begin?</h4>
                        <p>This journey will take 60-90 minutes if done in one sitting, but you can also work through 
                        it in multiple sessions. Your progress is automatically saved.</p>
                        <p><strong>Click "Basics" in the navigation above to continue.</strong></p>
                    </div>

                    <button class="btn btn-primary" onclick="markComplete(${index}); showSection(${index + 1})">
                        Start Learning ‚Üí
                    </button>
                </div>
            `;
        }

        function generateBasicsSection(index) {
            return `
                <div class="card">
                    <h2>What Are Reference Frames?</h2>
                    
                    <p style="font-size: 1.1rem; font-weight: 600; color: var(--primary);">
                        A reference frame is the operational structure that determines what information means and enables coordinated action.
                    </p>

                    <h3>The Four Key Functions</h3>
                    <p>Every reference frame specifies:</p>
                    
                    <div class="example-box">
                        <h4>1. What Counts as "The Same"</h4>
                        <p><strong>Equivalence classes and categories</strong></p>
                        <p>Example: Your visual system groups many different wavelengths as "blue" despite huge variation. 
                        It's created an equivalence class: "these diverse inputs count as the same color."</p>
                    </div>

                    <div class="example-box">
                        <h4>2. What Distinctions Matter</h4>
                        <p><strong>Which differences make a difference</strong></p>
                        <p>Example: A radiologist's frame makes tiny shadow differences meaningful (tumor vs. artifact). 
                        A novice's frame doesn't register these as significant distinctions.</p>
                    </div>

                    <div class="example-box">
                        <h4>3. How to Compare</h4>
                        <p><strong>Standards for measurement across contexts</strong></p>
                        <p>Example: "The train moves at 100 km/h" is meaningless until you specify: relative to the ground? 
                        Another train? The sun? Different frames give different velocities for the same physical situation.</p>
                    </div>

                    <div class="example-box">
                        <h4>4. What's Meaningful</h4>
                        <p><strong>Signal vs. noise, relevant vs. irrelevant</strong></p>
                        <p>Example: In a crowded room, your attention frame makes your name meaningful (you hear it immediately) 
                        while filtering out dozens of other conversations as noise.</p>
                    </div>

                    <div class="interactive-box">
                        <h4>üß™ Try It: Frame Recognition Exercise</h4>
                        <p>Think about this scenario:</p>
                        <p style="font-style: italic; padding: 1rem; background: white; border-radius: 8px;">
                            "You receive critical feedback on a project you worked hard on."
                        </p>
                        <p><strong>What frames could you use to interpret this?</strong></p>
                        <textarea class="frame-input" id="frameExercise1" placeholder="Type your different possible frames here...

Example: 
- Threat frame: 'They don't like me, I'm in danger of being fired'
- Growth frame: 'This is valuable information to improve my work'
- Political frame: 'This is about positioning, not actually about quality'

etc."></textarea>
                        <button class="btn btn-secondary" onclick="saveFrameExercise(1)">Save Your Reflection</button>
                        <div id="frameExercise1Feedback" style="margin-top: 1rem; display: none; padding: 1rem; background: #f0fdf4; border-radius: 8px;">
                            <p style="color: var(--success); font-weight: 600;">‚úì Great work! You're beginning to see how multiple frames are always possible.</p>
                        </div>
                    </div>

                    <h3>The Key Insight</h3>
                    <div class="warning-box">
                        <p style="font-size: 1.1rem; font-weight: 600;">
                            Information and meaning are always relative to frames.
                        </p>
                        <p>
                            The same physical stimulus, social action, or life event means different things depending 
                            on the reference frame through which it's interpreted. There's no "view from nowhere"‚Äîall 
                            observation is from some perspective, using some frame.
                        </p>
                    </div>

                    <h3>Examples Across Domains</h3>

                    <div class="example-box">
                        <h4>Physical Science</h4>
                        <p>Einstein's relativity: velocity, simultaneity, even time itself are relative to reference frames. 
                        Different observers moving at different speeds literally experience different realities‚Äîboth valid 
                        within their frames.</p>
                    </div>

                    <div class="example-box">
                        <h4>Perception</h4>
                        <p>Your "threat" category groups certain situations as equivalent (dark alley, angry dog, raised voice) 
                        while distinguishing them from "safe" situations. This frame determines your responses‚Äîfight, flight, 
                        freeze, or calm engagement.</p>
                    </div>

                    <div class="example-box">
                        <h4>Social Coordination</h4>
                        <p>Legal systems define reference frames for "assault," "property," "person." What counts as assault 
                        in one legal frame (unwanted touch) might not in another (contact sports). These frames structure 
                        social coordination and consequences.</p>
                    </div>

                    <div class="example-box">
                        <h4>Personal Meaning</h4>
                        <p>Consider failure:</p>
                        <ul>
                            <li><strong>Fixed frame:</strong> "I failed = I'm a failure = permanent limitation"</li>
                            <li><strong>Growth frame:</strong> "I failed = this approach didn't work = I can learn"</li>
                        </ul>
                        <p>Same event, completely different meaning, emotions, and future actions.</p>
                    </div>

                    <div class="interactive-box">
                        <h4>üéØ Quick Check: Do You Understand Frames?</h4>
                        <div class="quiz-question">
                            <p><strong>Which statement best captures what a reference frame does?</strong></p>
                            <div class="quiz-options" id="quiz1">
                                <div class="quiz-option" onclick="checkAnswer(1, 0, false)">
                                    A) It's your opinion about something
                                </div>
                                <div class="quiz-option" onclick="checkAnswer(1, 1, false)">
                                    B) It's the objective truth about a situation
                                </div>
                                <div class="quiz-option" onclick="checkAnswer(1, 2, true)">
                                    C) It determines what information means and what actions are appropriate
                                </div>
                                <div class="quiz-option" onclick="checkAnswer(1, 3, false)">
                                    D) It's a type of photograph
                                </div>
                            </div>
                            <div class="quiz-feedback" id="feedback1"></div>
                        </div>
                    </div>

                    <h3>Why This Matters</h3>
                    <p>
                        Once you understand reference frames, you can start to:
                    </p>
                    <ul>
                        <li><strong>Notice your frames in action</strong> ("I'm interpreting this as threat‚Äîcould I use a different frame?")</li>
                        <li><strong>Recognize others' frames</strong> ("They're not wrong, they're using a different frame")</li>
                        <li><strong>Choose frames strategically</strong> ("Which frame serves my authentic goals here?")</li>
                        <li><strong>Coordinate across different frames</strong> ("How can we bridge our different perspectives?")</li>
                    </ul>

                    <p style="margin-top: 2rem;">
                        <strong>Next:</strong> We'll explore how frames exist at every scale from cells to civilizations, 
                        and why cross-scale coordination is the fundamental challenge.
                    </p>

                    <button class="btn btn-primary" onclick="markComplete(${index}); showSection(${index + 1})">
                        Continue to Scale Hierarchy ‚Üí
                    </button>
                </div>
            `;
        }

        function generateScalesSection(index) {
            return `
                <div class="card">
                    <h2>The Scale Hierarchy</h2>
                    <p>
                        Reference frames aren't just cognitive or social‚Äîthey exist at <strong>every scale of organization</strong>, 
                        from molecules to civilizations.
                    </p>

                    <div class="warning-box">
                        <h4>The Cross-Scale Challenge</h4>
                        <p>
                            The hardest problems in human life occur when frames at different scales 
                            <strong>misalign</strong>. Understanding each scale helps you recognize where coordination 
                            breaks down‚Äîand how to fix it.
                        </p>
                    </div>

                    <h3>Interactive Scale Exploration</h3>
                    <p>Click each level to explore how reference frames operate at that scale:</p>

                    <div class="scale-viz">
                        <div class="scale-level bio" onclick="toggleScale(this)">
                            <h4>üß¨ Biological Scale: Cells and Tissues</h4>
                            <p>Bioelectric reference frames specify target patterns</p>
                            <div class="scale-detail">
                                <h4>How It Works:</h4>
                                <p><strong>Michael Levin's research</strong> (empirically robust, replicated) shows cells and tissues 
                                use bioelectric frames to coordinate:</p>
                                <ul>
                                    <li><strong>What counts as correct:</strong> Target morphology (proper head shape, limb position, etc.)</li>
                                    <li><strong>What counts as error:</strong> Deviations from target that trigger repair</li>
                                    <li><strong>How to compare:</strong> Bioelectric gradients across cells signal state differences</li>
                                    <li><strong>What's meaningful:</strong> Signals indicating "pattern is wrong, fix it"</li>
                                </ul>
                                <p><strong>Key Finding:</strong> You can <em>reprogram</em> these frames! Temporarily disrupt 
                                gap junctions, and planaria grow two heads instead of one‚Äîpermanently. The bioelectric reference 
                                frame has been reset.</p>
                                <p><strong>Your Body:</strong> From cells to organs, you're a hierarchy of reference frames 
                                maintaining coordinated patterns. Disease often means frame misalignment (cancer = cells ignoring 
                                tissue frame; autoimmune = immune frame misidentifying self).</p>
                            </div>
                        </div>

                        <div class="scale-level neural" onclick="toggleScale(this)">
                            <h4>üß† Neural Scale: Perception and Cognition</h4>
                            <p>Sensory, attentional, and conceptual frames</p>
                            <div class="scale-detail">
                                <h4>How It Works:</h4>
                                <p>Your brain constructs multiple levels of reference frames:</p>
                                <ul>
                                    <li><strong>Sensory frames:</strong> What counts as "same face" despite angles, lighting, expressions</li>
                                    <li><strong>Attentional frames:</strong> What features matter right now (color vs. shape, threat vs. opportunity)</li>
                                    <li><strong>Conceptual frames:</strong> Your categories and beliefs for making sense of experience</li>
                                    <li><strong>Memory frames:</strong> What counts as "same person" or "same situation" across time</li>
                                </ul>
                                <p><strong>Frame Switching:</strong> When you shift tasks, you're switching reference frames. 
                                "Focus on faces" vs. "focus on text" activates different neural networks‚Äîdifferent frames for 
                                processing the same visual input.</p>
                                <p><strong>Learning = Frame Development:</strong> Expertise is having more sophisticated frames. 
                                Radiologist sees meaningful patterns novice can't detect. Not more knowledge alone‚Äîdifferent 
                                frame for categorizing visual information.</p>
                            </div>
                        </div>

                        <div class="scale-level personal" onclick="toggleScale(this)">
                            <h4>üë§ Personal Scale: Identity and Meaning</h4>
                            <p>Your complete phenomenological reference frame (PRF)</p>
                            <div class="scale-detail">
                                <h4>Your PRF Includes:</h4>
                                <ul>
                                    <li><strong>Beliefs:</strong> Frames for what's true/false, real/unreal, possible/impossible</li>
                                    <li><strong>Rules:</strong> Frames for what's appropriate, acceptable, required in different contexts</li>
                                    <li><strong>Ontology:</strong> Frames for what exists, what has moral status, what matters</li>
                                    <li><strong>Values:</strong> Frames for what's good, meaningful, worth pursuing</li>
                                    <li><strong>Identity:</strong> Frames for what counts as "me" vs. "not me"</li>
                                </ul>
                                <p><strong>Example: Interpreting Failure</strong></p>
                                <ul>
                                    <li><em>Fixed mindset frame:</em> "I failed = I'm a failure = permanent limitation"</li>
                                    <li><em>Growth mindset frame:</em> "I failed = this approach didn't work = learning opportunity"</li>
                                </ul>
                                <p>Same event, completely different meaning. Your frame determines your emotional response, 
                                motivation, and future behavior.</p>
                                <p><strong>Temporal Coherence (ATCF):</strong> You need coordinated frames across time‚Äîpast makes sense 
                                (Historical Continuity), present is aligned (Present Integration), future feels authentic 
                                (Prospective Coherence), and you can modify frames when needed (Meta-Constructor Capacity).</p>
                            </div>
                        </div>

                        <div class="scale-level social" onclick="toggleScale(this)">
                            <h4>üåç Social Scale: Institutions and Culture</h4>
                            <p>Collective reference frames and coordination</p>
                            <div class="scale-detail">
                                <h4>How It Works:</h4>
                                <p>Cultures and institutions are <strong>collective reference frames</strong>‚Äîshared agreements 
                                about meaning and coordination:</p>
                                <ul>
                                    <li><strong>Language:</strong> Shared frames assigning meanings to sounds/symbols</li>
                                    <li><strong>Money:</strong> Collective frame agreeing "this counts as value"</li>
                                    <li><strong>Laws:</strong> Frames defining permissible/illegal, property/theft, person/non-person</li>
                                    <li><strong>Norms:</strong> Informal frames for appropriate/inappropriate, respectable/shameful</li>
                                    <li><strong>Institutions:</strong> Organizations embedding frames in structures and practices</li>
                                </ul>
                                <p><strong>Why Groups Conflict:</strong> Often it's not about facts but incompatible frames. 
                                Same event, interpreted through different cultural/ideological frames, generates completely 
                                different meanings and appropriate responses.</p>
                                <p><strong>Social Change = Frame Shifts:</strong> Abolition of slavery, women's suffrage, 
                                environmental protection‚Äîall involved societies examining old frames ("slaves are property," 
                                "women lack political capacity," "nature is pure resource") and reconstructing toward justice.</p>
                            </div>
                        </div>
                    </div>

                    <div class="interactive-box" style="margin-top: 2rem;">
                        <h4>üéØ Reflection: Cross-Scale Misalignment</h4>
                        <p>Think of a time when you experienced internal conflict or fragmentation. Can you identify 
                        frames at different scales that were misaligned?</p>
                        <p><strong>Example:</strong> "My body felt anxious (biological frame: danger), but I believed I was safe 
                        (cognitive frame: no threat), while my job required appearing calm (social frame: professional composure). 
                        All three scales misaligned‚Äîexhausting internal warfare."</p>
                        <textarea class="frame-input" id="scaleReflection" 
                            placeholder="Describe your experience of cross-scale frame misalignment..."></textarea>
                        <button class="btn btn-secondary" onclick="saveReflection('scale')">Save Reflection</button>
                    </div>

                    <h3>The Coordination Challenge</h3>
                    <p>
                        <strong>Frames must coordinate across all scales for human systems to function.</strong> When they don't:
                    </p>
                    <ul>
                        <li><strong>Personal level:</strong> Internal conflict, fragmentation, suffering (low Present Integration)</li>
                        <li><strong>Relational level:</strong> Misunderstanding, conflict, inability to coordinate</li>
                        <li><strong>Institutional level:</strong> Systems producing outcomes nobody wants</li>
                        <li><strong>Civilizational level:</strong> Short-term frames driving toward long-term catastrophe</li>
                    </ul>

                    <div class="warning-box">
                        <h4>Why This Is Fundamental</h4>
                        <p>
                            Most major problems‚Äîfrom depression to genocide to climate crisis‚Äîinvolve frame misalignment 
                            across scales. Understanding where the misalignment occurs suggests where intervention is needed.
                        </p>
                    </div>

                    <button class="btn btn-primary" onclick="markComplete(${index}); showSection(${index + 1})">
                        Continue to Meta-Constructor Capacity ‚Üí
                    </button>
                </div>
            `;
        }

        function generateMetaConstructorSection(index) {
            return `
                <div class="card">
                    <h2>Meta-Constructor Capacity</h2>
                    <p style="font-size: 1.1rem; font-weight: 600; color: var(--primary);">
                        The ability to examine, evaluate, and modify your own reference frames while maintaining coherent identity
                    </p>

                    <div class="example-box">
                        <h4>üîÑ The Recursive Magic</h4>
                        <p>Humans can do something remarkable: <strong>we can think about our thinking, 
                        question our assumptions, and deliberately change our minds.</strong></p>
                        <p>We can observe our own frames in action and ask: "Is this frame serving me? 
                        Could I use a different frame? How can I modify this while staying coherently myself?"</p>
                        <p><em>This is meta-constructor capacity‚Äîand it's what makes development possible.</em></p>
                    </div>

                    <h3>The Five Core Abilities</h3>

                    <div class="interactive-box">
                        <h4>1. Observe Your Frames</h4>
                        <p>Notice when you're operating within a particular frame:</p>
                        <ul>
                            <li>"I'm interpreting this as threat right now"</li>
                            <li>"I'm using my 'work self' frame, not my 'authentic self' frame"</li>
                            <li>"This belief is organizing my perception and responses"</li>
                        </ul>
                        <p><strong>Without this:</strong> You're completely identified with frames, can't see them, trapped in them</p>
                        <p><strong>With this:</strong> You have distance and choice‚Äîframes become tools, not prisons</p>
                    </div>

                    <div class="interactive-box">
                        <h4>2. Question Whether Frames Serve You</h4>
                        <p>Evaluate frames against your authentic values and goals:</p>
                        <ul>
                            <li>"Does this belief actually help me flourish?"</li>
                            <li>"Is this rule appropriate for this context?"</li>
                            <li>"Does this identity frame reflect who I really am, or who I was told to be?"</li>
                        </ul>
                        <p><strong>Without this:</strong> You maintain frames by default, even when harmful</p>
                        <p><strong>With this:</strong> You can recognize maladaptive frames and become motivated to change</p>
                    </div>

                    <div class="interactive-box">
                        <h4>3. Imagine Alternatives</h4>
                        <p>Generate different possible frames for the same situation:</p>
                        <ul>
                            <li>"I see this as failure, but could I frame it as learning?"</li>
                            <li>"I'm using competitive frame, but could cooperation work better here?"</li>
                            <li>"What if I tried the frame that person is using?"</li>
                        </ul>
                        <p><strong>Without this:</strong> You're stuck with inherited frames, can't conceive alternatives</p>
                        <p><strong>With this:</strong> You have flexibility and creativity in responding to challenges</p>
                    </div>

                    <div class="interactive-box">
                        <h4>4. Modify Frames Deliberately</h4>
                        <p>Actually change your frames through practice and intention:</p>
                        <ul>
                            <li>Therapy modifying threat frames through exposure and reconsolidation</li>
                            <li>Education installing new conceptual frames through learning</li>
                            <li>Practice building new habit frames through repetition</li>
                            <li>Mindfulness creating observer frame that can watch other frames</li>
                        </ul>
                        <p><strong>Without this:</strong> You see problems but can't change them</p>
                        <p><strong>With this:</strong> You're developmentally active, not stuck</p>
                    </div>

                    <div class="interactive-box">
                        <h4>5. Integrate Changes While Maintaining Identity</h4>
                        <p>Change frames without fragmenting or losing yourself:</p>
                        <ul>
                            <li>"My beliefs changed radically, but I'm still recognizably me"</li>
                            <li>"I've grown tremendously, but my core values remain"</li>
                            <li>"The thread of identity continues despite transformation"</li>
                        </ul>
                        <p><strong>Without this:</strong> Change causes fragmentation, identity crisis</p>
                        <p><strong>With this:</strong> You can develop across lifespan while maintaining coherent self</p>
                    </div>

                    <h3>Self-Assessment: Your Meta-Constructor Capacity</h3>
                    <p>Rate yourself honestly on each dimension (0 = never, 10 = consistently):</p>

                    <div class="slider-container">
                        <label><strong>I can notice my own mental frames in action:</strong></label>
                        <input type="range" min="0" max="10" value="5" class="slider" id="meta1" 
                            oninput="updateSliderValue('meta1')">
                        <div class="slider-labels">
                            <span>Never notice</span>
                            <span>Sometimes</span>
                            <span>Very aware</span>
                        </div>
                        <div class="slider-value" id="meta1-value">5</div>
                    </div>

                    <div class="slider-container">
                        <label><strong>I question whether my beliefs/patterns serve me:</strong></label>
                        <input type="range" min="0" max="10" value="5" class="slider" id="meta2"
                            oninput="updateSliderValue('meta2')">
                        <div class="slider-labels">
                            <span>Never question</span>
                            <span>Sometimes</span>
                            <span>Regularly examine</span>
                        </div>
                        <div class="slider-value" id="meta2-value">5</div>
                    </div>

                    <div class="slider-container">
                        <label><strong>I can imagine alternative ways to interpret situations:</strong></label>
                        <input type="range" min="0" max="10" value="5" class="slider" id="meta3"
                            oninput="updateSliderValue('meta3')">
                        <div class="slider-labels">
                            <span>Stuck in one view</span>
                            <span>Some flexibility</span>
                            <span>Very flexible</span>
                        </div>
                        <div class="slider-value" id="meta3-value">5</div>
                    </div>

                    <div class="slider-container">
                        <label><strong>I actually change my mind when evidence warrants:</strong></label>
                        <input type="range" min="0" max="10" value="5" class="slider" id="meta4"
                            oninput="updateSliderValue('meta4')">
                        <div class="slider-labels">
                            <span>Very rigid</span>
                            <span>Somewhat open</span>
                            <span>Eagerly update</span>
                        </div>
                        <div class="slider-value" id="meta4-value">5</div>
                    </div>

                    <div class="slider-container">
                        <label><strong>I maintain identity coherence through changes:</strong></label>
                        <input type="range" min="0" max="10" value="5" class="slider" id="meta5"
                            oninput="updateSliderValue('meta5')">
                        <div class="slider-labels">
                            <span>Changes fragment me</span>
                            <span>Usually okay</span>
                            <span>Strong coherence</span>
                        </div>
                        <div class="slider-value" id="meta5-value">5</div>
                    </div>

                    <button class="btn btn-secondary" onclick="calculateMetaScore()" style="margin-top: 1rem;">
                        Calculate My Meta-Constructor Score
                    </button>
                    <div id="metaScore" style="display: none; margin-top: 1rem;"></div>

                    <h3>Why It Can Be Low</h3>
                    <div class="warning-box">
                        <h4>Defensive Rigidity (Protection, Not Weakness)</h4>
                        <p>Low meta-constructor capacity often develops as <strong>adaptive response to threat</strong>:</p>
                        <ul>
                            <li><strong>Trauma:</strong> Examining certain frames feels dangerous, triggers flashbacks</li>
                            <li><strong>Identity protection:</strong> Core beliefs feel like "me"‚Äîquestioning them feels like dying</li>
                            <li><strong>Social pressure:</strong> Your community forbids questioning certain frames</li>
                            <li><strong>Cognitive load:</strong> You're so stressed that meta-level thinking is impossible</li>
                        </ul>
                        <p><em>This isn't a moral failing. It's often protection that once served you but now limits you.</em></p>
                    </div>

                    <h3>How to Develop It</h3>
                    <p><strong>Meta-constructor capacity can be cultivated through practice:</strong></p>
                    <ul>
                        <li><strong>Therapy:</strong> Especially approaches that work with beliefs and patterns (CBT, schema therapy, IFS)</li>
                        <li><strong>Meditation:</strong> Builds observer capacity‚Äîwatching thoughts without identifying with them</li>
                        <li><strong>Philosophy/Critical Thinking:</strong> Practice examining assumptions and arguments</li>
                        <li><strong>Diverse Perspectives:</strong> Engaging with people who think very differently</li>
                        <li><strong>Journaling:</strong> Writing about beliefs, patterns, changes over time</li>
                        <li><strong>Feedback from Trusted Others:</strong> They see our blind spots</li>
                    </ul>

                    <div class="example-box">
                        <h4>üí° The Recursive Achievement</h4>
                        <p>Here's the beautiful part: <strong>You can use your meta-constructor capacity to improve 
                        your meta-constructor capacity.</strong></p>
                        <p>You can examine your capacity to examine yourself, learn how to learn better, think about 
                        how you think. Each iteration builds on the previous one.</p>
                        <p>This is why humans can develop across entire lifespans‚Äîwe're not stuck with our initial 
                        programming. We can reprogram ourselves.</p>
                    </div>

                    <button class="btn btn-primary" onclick="markComplete(${index}); showSection(${index + 1})">
                        Continue to Temporal Coherence ‚Üí
                    </button>
                </div>
            `;
        }

        function generateATCFSection(index) {
            return `
                <div class="card">
                    <h2>Temporal Coherence (ATCF)</h2>
                    <p style="font-size: 1.1rem; font-weight: 600; color: var(--primary);">
                        How well your reference frames maintain coherent identity across past, present, and future
                    </p>

                    <p>
                        Meta-constructor capacity (examining and modifying frames) is necessary but not sufficient. 
                        You also need frames that <strong>cohere across time</strong>‚Äîyour past makes sense, your present 
                        is aligned, your future is authentic, and you can change while staying yourself.
                    </p>

                    <div class="warning-box">
                        <h4>What ATCF Measures</h4>
                        <p><strong>ATCF = Adaptive Temporal Coherence Function</strong></p>
                        <p>It's not a single score but four interconnected components that together determine 
                        whether you can maintain coherent identity while developing across time.</p>
                    </div>

                    <h3>The Four Components</h3>

                    <div class="interactive-box">
                        <h4>1. Historical Continuity</h4>
                        <p><strong>Can you recognize yourself across time?</strong></p>
                        <p><em>Your past makes coherent sense as part of your story</em></p>
                        
                        <p><strong>High Historical Continuity looks like:</strong></p>
                        <ul>
                            <li>Your life story feels connected and meaningful</li>
                            <li>Difficult periods are integrated, not blank or dissociated</li>
                            <li>You can see thread of "you" across changes</li>
                            <li>Past informs present without imprisoning you</li>
                        </ul>

                        <p><strong>Low Historical Continuity looks like:</strong></p>
                        <ul>
                            <li>Gaps or blank periods in memory</li>
                            <li>Past feels alien, like "that wasn't really me"</li>
                            <li>Fragmented narrative, can't tell coherent story</li>
                            <li>Unintegrated trauma disrupting continuity</li>
                        </ul>

                        <p><strong>Quick self-check:</strong> "The person I was 10 years ago is fundamentally me, 
                        despite changes" (agree = high, disagree = low)</p>
                    </div>

                    <div class="interactive-box">
                        <h4>2. Present Integration</h4>
                        <p><strong>Do you make sense to yourself right now?</strong></p>
                        <p><em>Current frames across levels are aligned and coordinated</em></p>
                        
                        <p><strong>High Present Integration looks like:</strong></p>
                        <ul>
                            <li>Actions match stated values</li>
                            <li>Body, mind, and behavior aligned</li>
                            <li>Can be authentic across contexts</li>
                            <li>Internal coherence, not warring parts</li>
                        </ul>

                        <p><strong>Low Present Integration looks like:</strong></p>
                        <ul>
                            <li>"I say I value X but do Y constantly"</li>
                            <li>Body says danger, mind says safe (chronic misalignment)</li>
                            <li>Different "selves" in different contexts (work-me vs. real-me)</li>
                            <li>Constant internal conflict and fragmentation</li>
                        </ul>

                        <p><strong>Quick self-check:</strong> "My actions this week aligned with what matters most to me" 
                        (agree = high, disagree = low)</p>
                    </div>

                    <div class="interactive-box">
                        <h4>3. Prospective Coherence</h4>
                        <p><strong>Can you imagine an authentic future?</strong></p>
                        <p><em>Future self feels connected to present identity and values</em></p>
                        
                        <p><strong>High Prospective Coherence looks like:</strong></p>
                        <ul>
                            <li>Can vividly imagine future that feels like "you"</li>
                            <li>Goals aligned with authentic identity, not absorbed</li>
                            <li>Hope and agency about future trajectory</li>
                            <li>Can see path from here to there</li>
                        </ul>

                        <p><strong>Low Prospective Coherence looks like:</strong></p>
                        <ul>
                            <li>Future feels blank, can't imagine continuing</li>
                            <li>Goals feel alien (dentistry when you want music)</li>
                            <li>Despair, no hope for meaningful future</li>
                            <li>Can't see yourself in imagined futures</li>
                        </ul>

                        <p><strong>Quick self-check:</strong> "I can clearly imagine myself 5 years from now in a way that 
                        feels authentic" (yes = high, no = low)</p>
                    </div>

                    <div class="interactive-box">
                        <h4>4. Meta-Constructor Capacity</h4>
                        <p><strong>Can you change while remaining yourself?</strong></p>
                        <p><em>Ability to examine and modify frames while maintaining identity</em></p>
                        
                        <p>(We covered this in detail in the previous section!)</p>
                        <p><strong>Quick reminder:</strong> Can you notice your frames, question them, imagine alternatives, 
                        modify deliberately, and integrate changes without fragmenting?</p>
                    </div>

                    <h3>Your ATCF Self-Assessment</h3>
                    <p>Rate yourself honestly on each component (1 = very low, 10 = very high):</p>

                    <div class="slider-container">
                        <label><strong>Historical Continuity:</strong> My past makes coherent sense as part of my story</label>
                        <input type="range" min="1" max="10" value="5" class="slider" id="atcf1" 
                            oninput="updateSliderValue('atcf1')">
                        <div class="slider-value" id="atcf1-value">5</div>
                    </div>

                    <div class="slider-container">
                        <label><strong>Present Integration:</strong> My actions, values, and different roles are aligned</label>
                        <input type="range" min="1" max="10" value="5" class="slider" id="atcf2"
                            oninput="updateSliderValue('atcf2')">
                        <div class="slider-value" id="atcf2-value">5</div>
                    </div>

                    <div class="slider-container">
                        <label><strong>Prospective Coherence:</strong> I can imagine an authentic future that feels like me</label>
                        <input type="range" min="1" max="10" value="5" class="slider" id="atcf3"
                            oninput="updateSliderValue('atcf3')">
                        <div class="slider-value" id="atcf3-value">5</div>
                    </div>

                    <div class="slider-container">
                        <label><strong>Meta-Constructor Capacity:</strong> I can examine and modify my frames while staying myself</label>
                        <input type="range" min="1" max="10" value="5" class="slider" id="atcf4"
                            oninput="updateSliderValue('atcf4')">
                        <div class="slider-value" id="atcf4-value">5</div>
                    </div>

                    <button class="btn btn-secondary" onclick="calculateATCF()" style="margin-top: 1rem;">
                        Calculate My ATCF Profile
                    </button>
                    <div id="atcfResults" style="display: none; margin-top: 1rem;"></div>

                    <div class="warning-box" style="margin-top: 2rem;">
                        <h4>‚ö†Ô∏è Important Note</h4>
                        <p>This is <strong>informal self-reflection</strong>, not clinical assessment. The numbers 
                        help you think about patterns, but your lived experience is primary.</p>
                        <p>If your total score is below 20 (average of 5 per component), or if you're experiencing 
                        significant distress, consider seeking professional support.</p>
                    </div>

                    <h3>Why All Four Matter</h3>
                    <p>The four components work together as a system. Problems in one affect the others:</p>
                    <ul>
                        <li><strong>Low Historical Continuity</strong> ‚Üí harder to maintain Present Integration (unintegrated 
                        past keeps intruding) and Prospective Coherence (can't build future on fragmented past)</li>
                        <li><strong>Low Present Integration</strong> ‚Üí harder to project authentic future (which self's future?)</li>
                        <li><strong>Low Prospective Coherence</strong> ‚Üí harder to stay motivated in present (why bother if 
                        no meaningful future?)</li>
                        <li><strong>Low Meta-Constructor</strong> ‚Üí can't fix problems in other components (stuck with whatever 
                        you have)</li>
                    </ul>

                    <p><strong>High ATCF = All four functioning well together</strong> = You can flourish, develop, 
                    and coordinate effectively across time and with diverse others.</p>

                    <button class="btn btn-primary" onclick="markComplete(${index}); showSection(${index + 1})">
                        Continue to Applications ‚Üí
                    </button>
                </div>
            `;
        }

        function generateApplicationsSection(index) {
            return `
                <div class="card">
                    <h2>Real-World Applications</h2>
                    <p>
                        Reference frame thinking provides leverage for addressing challenges from personal meaning 
                        to global crises. Click each area to explore applications:
                    </p>

                    <div class="app-grid">
                        <div class="app-card" onclick="showApplication('inequality')">
                            <div class="icon">üí∞</div>
                            <h4>Income Inequality</h4>
                            <p>When economic frames override human frames</p>
                        </div>

                        <div class="app-card" onclick="showApplication('discrimination')">
                            <div class="icon">‚öñÔ∏è</div>
                            <h4>Discrimination</h4>
                            <p>When categorical frames override individual reality</p>
                        </div>

                        <div class="app-card" onclick="showApplication('conflict')">
                            <div class="icon">üïäÔ∏è</div>
                            <h4>War & Genocide</h4>
                            <p>When group identity frames override common humanity</p>
                        </div>

                        <div class="app-card" onclick="showApplication('existential')">
                            <div class="icon">üåç</div>
                            <h4>Existential Risks</h4>
                            <p>When temporal frames misalign with reality</p>
                        </div>

                        <div class="app-card" onclick="showApplication('meaning')">
                            <div class="icon">üéØ</div>
                            <h4>Personal Meaning</h4>
                            <p>When frames align with authentic values</p>
                        </div>

                        <div class="app-card" onclick="showApplication('therapy')">
                            <div class="icon">üß†</div>
                            <h4>Therapy & Healing</h4>
                            <p>Frame reconstruction for recovery</p>
                        </div>
                    </div>

                    <div id="applicationDetails" style="display: none; margin-top: 2rem;">
                        <!-- Application details will be inserted here -->
                    </div>

                    <div class="warning-box" style="margin-top: 2rem;">
                        <h4>üîë The Unifying Pattern</h4>
                        <p>
                            Notice what all these applications share: <strong>Problems emerge from frame misalignment 
                            or inappropriate frames. Solutions involve frame awareness, examination, and reconstruction.</strong>
                        </p>
                        <p>
                            Whether it's personal depression or global climate crisis, the pattern is the same: 
                            Frames determine meaning and action. Better frames ‚Üí better outcomes.
                        </p>
                    </div>

                    <h3>What Makes This Practical</h3>
                    <p>Understanding reference frames gives you:</p>
                    <ul>
                        <li><strong>Diagnostic clarity:</strong> "Where exactly is the frame problem?"</li>
                        <li><strong>Intervention points:</strong> "Which frame needs to change?"</li>
                        <li><strong>Coordination strategies:</strong> "How can we bridge different frames?"</li>
                        <li><strong>Developmental pathways:</strong> "How do we build better frames?"</li>
                    </ul>

                    <div class="interactive-box">
                        <h4>üéØ Your Turn: Apply Frame Analysis</h4>
                        <p>Think of a problem you're currently facing‚Äîpersonal, relational, professional, or social.</p>
                        <p><strong>Analyze it through the reference frame lens:</strong></p>
                        <ul>
                            <li>What frames are operating? (Yours? Others? Institutional?)</li>
                            <li>Are frames misaligned across scales or people?</li>
                            <li>Which frame is causing the problem?</li>
                            <li>What alternative frame might work better?</li>
                            <li>How could you shift to that frame?</li>
                        </ul>
                        <textarea class="frame-input" id="problemAnalysis" 
                            placeholder="Describe your problem and analyze the reference frames involved..."></textarea>
                        <button class="btn btn-secondary" onclick="saveAnalysis('problem')">Save Your Analysis</button>
                    </div>

                    <button class="btn btn-primary" onclick="markComplete(${index}); showSection(${index + 1})">
                        Continue to Personal Practice ‚Üí
                    </button>
                </div>
            `;
        }

        function generatePracticeSection(index) {
            return `
                <div class="card">
                    <h2>Personal Practice: Daily Frame Work</h2>
                    <p>
                        Understanding frames intellectually is valuable. But <strong>developing frame literacy through 
                        practice</strong> is transformative. Here are evidence-based practices you can start today.
                    </p>

                    <h3>Morning Frame-Setting (5 minutes)</h3>
                    <div class="interactive-box">
                        <h4>üåÖ Start Your Day with Intention</h4>
                        <p><strong>Ask yourself:</strong></p>
                        <ul>
                            <li>"What frame am I bringing to today?"</li>
                            <li>"What matters most? (What will I treat as signal vs. noise?)"</li>
                            <li>"Who am I being today?" (Identity frame selection)</li>
                            <li>"What challenges might trigger automatic frames I want to avoid?"</li>
                        </ul>
                        <p><strong>Why this works:</strong> Explicit frame-setting increases awareness and choice. 
                        You're less likely to operate on autopilot.</p>
                    </div>

                    <h3>Moment-to-Moment Frame Awareness</h3>
                    <div class="interactive-box">
                        <h4>‚è±Ô∏è Throughout Your Day</h4>
                        <p><strong>When you notice strong emotion or reaction:</strong></p>
                        <ol>
                            <li><strong>Pause:</strong> Don't act immediately</li>
                            <li><strong>Notice:</strong> "What frame am I in right now?"</li>
                            <li><strong>Name it:</strong> "Threat frame" / "Scarcity frame" / "Perfectionist frame"</li>
                            <li><strong>Ask:</strong> "Is this frame serving me here?"</li>
                            <li><strong>Consider:</strong> "What other frame could I try?"</li>
                            <li><strong>Experiment:</strong> Shift frames and notice what changes</li>
                        </ol>
                        <p><strong>Start small:</strong> Try this once per day. Build the habit gradually.</p>
                    </div>

                    <h3>Evening Frame Review (10 minutes)</h3>
                    <div class="interactive-box">
                        <h4>üåô End-of-Day Reflection</h4>
                        <p><strong>Journal on these questions:</strong></p>
                        <ul>
                            <li><strong>Historical Continuity check:</strong> "What happened today that connects to my story? 
                            What can I learn from past experiences?"</li>
                            <li><strong>Present Integration check:</strong> "When was I aligned today? When fragmented? 
                            Did my actions match my values?"</li>
                            <li><strong>Prospective Coherence check:</strong> "Am I moving toward authentic future? 
                            What small step can I take tomorrow?"</li>
                            <li><strong>Meta-Constructor development:</strong> "What did I learn about my frames today? 
                            What would I do differently?"</li>
                        </ul>
                    </div>

                    <h3>Choose Your Starting Practice</h3>
                    <div class="interactive-box">
                        <h4>üéØ Your Practice Commitment</h4>
                        <p>Which practice will you start with? Choose ONE and commit to 2 weeks:</p>
                        <select id="startingPractice" class="frame-input" onchange="saveStartingPractice()">
                            <option value="">Select a practice...</option>
                            <option value="morning">Morning frame-setting (5 min daily)</option>
                            <option value="moment">Moment-to-moment awareness (when triggered)</option>
                            <option value="evening">Evening review (10 min daily)</option>
                            <option value="weekly">Weekly frame journal</option>
                            <option value="mindfulness">Mindfulness meditation (20 min daily)</option>
                            <option value="perspective">Perspective-taking practice (daily)</option>
                            <option value="future">Future self-visualization (weekly)</option>
                        </select>
                        <div id="practiceCommitment" style="display: none; margin-top: 1rem;"></div>
                    </div>

                    <div class="warning-box">
                        <h4>‚ö†Ô∏è Important Reminders</h4>
                        <ul>
                            <li><strong>Start small:</strong> Pick ONE practice to begin with, not all at once</li>
                            <li><strong>Be patient:</strong> Frame literacy develops over months and years, not days</li>
                            <li><strong>Self-compassion:</strong> You'll forget, regress, struggle‚Äîthat's normal</li>
                            <li><strong>Seek support:</strong> This work is easier with help (therapy, coaching, community)</li>
                            <li><strong>Know your limits:</strong> If frames are trauma-related, work with professional</li>
                        </ul>
                    </div>

                    <button class="btn btn-primary" onclick="markComplete(${index}); showSection(${index + 1})">
                        Create Your Action Plan & Submit ‚Üí
                    </button>
                </div>
            `;
        }

        function generateActionPlanSection(index) {
            return `
                <div class="card">
                    <h2>üìö Assignment Submission</h2>
                    
                    <div class="assignment-card">
                        <h3>üìù Complete Your Learning Journey</h3>
                        <p style="font-size: 1.1rem; margin-bottom: 1rem;">
                            You've worked through an interactive learning experience. Now it's time to submit your work!
                        </p>
                        
                        <div class="assignment-checklist">
                            <h4 style="margin-bottom: 1rem;">‚úÖ Required Completion Checklist</h4>
                            <div class="checklist-item">
                                <span class="checklist-icon">üìñ</span>
                                <span><strong>Read the Complete Essay:</strong> Review the full PDF document</span>
                            </div>
                            <div class="checklist-item">
                                <span class="checklist-icon">‚úçÔ∏è</span>
                                <span><strong>Complete All 8 Sections:</strong> Work through every module</span>
                            </div>
                            <div class="checklist-item">
                                <span class="checklist-icon">üìä</span>
                                <span><strong>Self-Assessments:</strong> Fill out ATCF and Meta-Constructor scores</span>
                            </div>
                            <div class="checklist-item">
                                <span class="checklist-icon">üí≠</span>
                                <span><strong>Written Reflections:</strong> Complete all exercise prompts thoughtfully</span>
                            </div>
                            <div class="checklist-item">
                                <span class="checklist-icon">üéØ</span>
                                <span><strong>Practice Commitment:</strong> Select your development priority</span>
                            </div>
                        </div>

                        <div class="submission-options">
                            <button class="submission-btn" onclick="viewPDF()">
                                <span class="icon">üìñ</span>
                                <span>Read Full Essay</span>
                            </button>
                            <button class="submission-btn" onclick="showExportModal()">
                                <span class="icon">üìã</span>
                                <span>Export My Work</span>
                            </button>
                            <button class="submission-btn" onclick="downloadPDF()">
                                <span class="icon">üíæ</span>
                                <span>Download PDF</span>
                            </button>
                        </div>
                    </div>

                    <h3>Your Current Status</h3>
                    <div class="interactive-box">
                        <h4>üìä Completion Summary</h4>
                        <p><strong>Sections Completed:</strong> <span id="sectionsCompleted">${state.completedSections.size}/8</span></p>
                        <p><strong>ATCF Assessment:</strong> <span id="atcfStatus">Not completed</span></p>
                        <p><strong>Meta-Constructor Assessment:</strong> <span id="metaStatus">Not completed</span></p>
                        <p><strong>Reflections:</strong> <span id="reflectionsStatus">Check each section</span></p>
                    </div>

                    <h3>üì§ How to Submit Your Work</h3>
                    <div class="example-box">
                        <h4>Three Easy Submission Options:</h4>
                        <ol>
                            <li><strong>Copy & Paste (Easiest):</strong>
                                <ul>
                                    <li>Click "Export My Work" button above or the floating üìã button</li>
                                    <li>Choose "Copy Formatted Text"</li>
                                    <li>Paste into your email or LMS submission box</li>
                                    <li>Add your name and submit!</li>
                                </ul>
                            </li>
                            <li><strong>Download File:</strong>
                                <ul>
                                    <li>Click "Export My Work"</li>
                                    <li>Choose "Download Text Document"</li>
                                    <li>Open in Word/Google Docs to add final touches</li>
                                    <li>Upload to your LMS or email to instructor</li>
                                </ul>
                            </li>
                            <li><strong>Backup Option:</strong>
                                <ul>
                                    <li>Click "Download Data Backup (JSON)"</li>
                                    <li>This saves all your work in case of technical issues</li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <h3>üìã Grading Rubric</h3>
                    <div class="warning-box">
                        <h4>How Your Work Will Be Evaluated (100 points total):</h4>
                        <ul>
                            <li><strong>Completion (40 points):</strong> All sections finished, all assessments completed</li>
                            <li><strong>Reflection Quality (40 points):</strong> Thoughtful, specific, well-written responses to exercises</li>
                            <li><strong>Understanding (20 points):</strong> Evidence you grasp core concepts (shown in reflections)</li>
                        </ul>
                        <p style="margin-top: 1rem;"><em>Note: Self-assessment scores are NOT graded for "correctness"‚Äîthey're about honest self-reflection.</em></p>
                    </div>

                    <h3>‚ùì Frequently Asked Questions</h3>
                    <div class="interactive-box">
                        <h4>Q: Can I see what I'm submitting before I send it?</h4>
                        <p><strong>A:</strong> Yes! Click "Copy Formatted Text" and a preview appears at the bottom. Review it before submitting.</p>

                        <h4>Q: What if I close my browser?</h4>
                        <p><strong>A:</strong> Your work is saved automatically. Just open this page again and continue where you left off.</p>

                        <h4>Q: Can I edit my submission after exporting?</h4>
                        <p><strong>A:</strong> Yes! The text file can be opened and edited in Word/Google Docs before submission.</p>

                        <h4>Q: How long should my reflections be?</h4>
                        <p><strong>A:</strong> 3-5 sentences minimum for each exercise. Quality over quantity‚Äîbe specific and thoughtful.</p>

                        <h4>Q: When is this due?</h4>
                        <p><strong>A:</strong> Check with your instructor for the specific due date.</p>
                    </div>

                    <div style="text-align: center; margin-top: 3rem; padding: 2rem; background: var(--bg-light); border-radius: 12px;">
                        <h4 style="color: var(--primary); margin-bottom: 1rem;">üéâ Ready to Submit?</h4>
                        <p style="margin-bottom: 1.5rem;">Make sure everything is complete, then export your work!</p>
                        <button class="btn btn-success" onclick="showExportModal()" style="font-size: 1.2rem; padding: 1.2rem 2.5rem;">
                            üìã Export & Submit Assignment
                        </button>
                    </div>

                    <button class="btn btn-primary" onclick="markComplete(${index})">
                        ‚úì Mark This Section Complete
                    </button>
                </div>
            `;
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function toggleScale(element) {
            element.classList.toggle('expanded');
        }

        function updateSliderValue(id) {
            const slider = document.getElementById(id);
            const display = document.getElementById(id + '-value');
            display.textContent = slider.value;
        }

        function checkAnswer(quizNum, optionIndex, isCorrect) {
            const quiz = document.getElementById(`quiz${quizNum}`);
            const feedback = document.getElementById(`feedback${quizNum}`);
            const options = quiz.querySelectorAll('.quiz-option');
            
            options.forEach((opt, i) => {
                opt.style.pointerEvents = 'none';
                if (i === optionIndex) {
                    opt.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            });

            feedback.classList.add('show', isCorrect ? 'correct' : 'incorrect');
            feedback.innerHTML = isCorrect 
                ? '‚úì <strong>Correct!</strong> Reference frames determine what information means and what actions make sense‚Äîthey\'re operational structures, not just opinions or facts.'
                : '‚úó <strong>Not quite.</strong> Reference frames are more than opinions or truth claims‚Äîthey\'re the operational structures that determine what information means and enables action.';
        }

        function saveFrameExercise(num) {
            const input = document.getElementById(`frameExercise${num}`);
            const feedback = document.getElementById(`frameExercise${num}Feedback`);
            if (input.value.trim()) {
                state.userNotes[`frameExercise${num}`] = input.value;
                saveState();
                feedback.style.display = 'block';
            }
        }

        function saveReflection(type) {
            const input = document.getElementById(`${type}Reflection`);
            if (input && input.value.trim()) {
                state.userNotes[`${type}Reflection`] = input.value;
                saveState();
                alert('‚úì Reflection saved!');
            }
        }

        function saveAnalysis(type) {
            const input = document.getElementById(`${type}Analysis`);
            if (input && input.value.trim()) {
                state.userNotes[`${type}Analysis`] = input.value;
                saveState();
                alert('‚úì Analysis saved!');
            }
        }

        function calculateMetaScore() {
            const scores = [];
            for (let i = 1; i <= 5; i++) {
                scores.push(parseInt(document.getElementById(`meta${i}`).value));
            }
            const avg = scores.reduce((a, b) => a + b) / scores.length;
            const total = scores.reduce((a, b) => a + b);

            let interpretation = '';
            if (avg >= 8) {
                interpretation = '<strong>High Meta-Constructor Capacity</strong> - You have strong ability to examine and modify your frames while maintaining coherence. Continue developing through practice.';
            } else if (avg >= 6) {
                interpretation = '<strong>Moderate Meta-Constructor Capacity</strong> - You have decent flexibility but room for growth. Focus on the dimensions where you scored lower.';
            } else if (avg >= 4) {
                interpretation = '<strong>Developing Meta-Constructor Capacity</strong> - You\'re building this skill but still find it challenging. Regular practice will help, consider working with therapist or coach.';
            } else {
                interpretation = '<strong>Low Meta-Constructor Capacity</strong> - You may be stuck in rigid patterns or protected by defensive frames. Professional support could be very helpful.';
            }

            const scoreDiv = document.getElementById('metaScore');
            scoreDiv.innerHTML = `
                <div class="interactive-box">
                    <h4>Your Meta-Constructor Profile</h4>
                    <p><strong>Total Score: ${total}/50 (Average: ${avg.toFixed(1)}/10)</strong></p>
                    <p>${interpretation}</p>
                    <p><strong>Individual Scores:</strong></p>
                    <ul>
                        <li>Observe frames: ${scores[0]}/10</li>
                        <li>Question frames: ${scores[1]}/10</li>
                        <li>Imagine alternatives: ${scores[2]}/10</li>
                        <li>Modify deliberately: ${scores[3]}/10</li>
                        <li>Maintain coherence: ${scores[4]}/10</li>
                    </ul>
                </div>
            `;
            scoreDiv.style.display = 'block';

            state.quizScores.metaConstructor = { total, avg, scores };
            saveState();
            updateSubmissionStatus();
        }

        function calculateATCF() {
            const scores = [];
            for (let i = 1; i <= 4; i++) {
                scores.push(parseInt(document.getElementById(`atcf${i}`).value));
            }
            const total = scores.reduce((a, b) => a + b);
            const avg = total / 4;

            const components = [
                'Historical Continuity',
                'Present Integration',
                'Prospective Coherence',
                'Meta-Constructor Capacity'
            ];

            const lowest = Math.min(...scores);
            const lowestIndex = scores.indexOf(lowest);

            let interpretation = '';
            if (avg >= 8) {
                interpretation = 'You have <strong>high temporal coherence</strong>. Continue maintaining and refining.';
            } else if (avg >= 6) {
                interpretation = 'You have <strong>moderate coherence</strong> with room for development.';
            } else if (avg >= 4) {
                interpretation = 'You\'re <strong>experiencing challenges</strong> with temporal coherence. Focused work would help.';
            } else {
                interpretation = 'You may be <strong>struggling significantly</strong>. Consider professional support.';
            }

            const resultsDiv = document.getElementById('atcfResults');
            resultsDiv.innerHTML = `
                <div class="interactive-box">
                    <h4>Your ATCF Profile</h4>
                    <p><strong>Total: ${total}/40 (Average: ${avg.toFixed(1)}/10)</strong></p>
                    <p>${interpretation}</p>
                    <p><strong>Component Scores:</strong></p>
                    <ul>
                        ${components.map((c, i) => 
                            `<li>${c}: ${scores[i]}/10 ${i === lowestIndex ? '‚Üê <em>Focus here</em>' : ''}</li>`
                        ).join('')}
                    </ul>
                    <p><strong>Recommendation:</strong> Focus development work on <strong>${components[lowestIndex]}</strong> 
                    (your lowest score). Improving this will likely help other components.</p>
                </div>
            `;
            resultsDiv.style.display = 'block';

            state.quizScores.atcf = { total, avg, scores };
            saveState();
            updateSubmissionStatus();
        }

        function showApplication(type) {
            const details = document.getElementById('applicationDetails');
            const content = {
                inequality: `
                    <div class="example-box">
                        <h3>üí∞ Income Inequality: Frame Analysis</h3>
                        <p><strong>The Problem:</strong> Economic frames treating humans as units override human frames valuing dignity.</p>
                        <p><strong>Frame Misalignment:</strong></p>
                        <ul>
                            <li>Economic frame: "Maximize productivity, minimize labor costs"</li>
                            <li>Human frame: "I want meaningful work, security, time for family"</li>
                            <li>Short-term frame: "Quarterly earnings matter most"</li>
                            <li>Long-term frame: "Extreme inequality destabilizes everything"</li>
                        </ul>
                        <p><strong>Frame Solutions:</strong></p>
                        <ul>
                            <li>Frame awareness: Recognize economic metrics are choices, not natural law</li>
                            <li>Frame diversification: Measure well-being, not just GDP</li>
                            <li>Frame coordination: Design institutions aligning individual and systemic health</li>
                        </ul>
                    </div>
                `,
                discrimination: `
                    <div class="example-box">
                        <h3>‚öñÔ∏è Discrimination: Categorical Frames Override Individuals</h3>
                        <p><strong>The Problem:</strong> Category membership determines treatment regardless of individual characteristics.</p>
                        <p><strong>How Frames Perpetuate It:</strong></p>
                        <ul>
                            <li>Perceptual frames: Implicit bias makes category membership salient</li>
                            <li>Conceptual frames: Stereotypes group people despite individual variation</li>
                            <li>Institutional frames: Laws and policies encode categorical treatment</li>
                        </ul>
                        <p><strong>Frame Solutions:</strong></p>
                        <ul>
                            <li>Individual: Frame awareness training, deliberate individuation</li>
                            <li>Institutional: Blind processes, frame audits for disparate impact</li>
                            <li>Systemic: Collective examination of whether categorical frames serve flourishing</li>
                        </ul>
                    </div>
                `,
                conflict: `
                    <div class="example-box">
                        <h3>üïäÔ∏è War & Genocide: Group Identity Overrides Humanity</h3>
                        <p><strong>The Catastrophe:</strong> Groups recategorize others as non-human within moral frames.</p>
                        <p><strong>The Pattern:</strong></p>
                        <ol>
                            <li>Frame preparation: Propaganda establishing new categories</li>
                            <li>Frame enforcement: Punish those maintaining human-to-human frame</li>
                            <li>Frame amplification: Social pressure, institutional support</li>
                            <li>Action follows frame: Violence becomes "logical"</li>
                        </ol>
                        <p><strong>Frame Prevention:</strong></p>
                        <ul>
                            <li>Maintain cross-group frames: Emphasize common humanity</li>
                            <li>Contact and cooperation: Shared projects require coordination</li>
                            <li>Frame monitoring: Watch for dehumanizing language</li>
                        </ul>
                    </div>
                `,
                existential: `
                    <div class="example-box">
                        <h3>üåç Existential Risks: Temporal Frame Misalignment</h3>
                        <p><strong>The Problem:</strong> Short-term frames driving toward long-term catastrophe.</p>
                        <p><strong>Frame Misalignment:</strong></p>
                        <ul>
                            <li>Individual frames: This week, this month, this year</li>
                            <li>Economic frames: Quarterly earnings, annual growth</li>
                            <li>Political frames: 2-4 year election cycles</li>
                            <li>Reality frames: Decades to centuries for full impact</li>
                        </ul>
                        <p><strong>Frame Solutions:</strong></p>
                        <ul>
                            <li>Extend temporal frames: Future-self connection, cathedral thinking</li>
                            <li>Institutional design: Structures representing future generations</li>
                            <li>Aligned incentives: Make success depend on long-term outcomes</li>
                        </ul>
                    </div>
                `,
                meaning: `
                    <div class="example-box">
                        <h3>üéØ Personal Meaning: Frame Alignment</h3>
                        <p><strong>The Question:</strong> How do I build a life worth living?</p>
                        <p><strong>What Goes Wrong:</strong></p>
                        <ul>
                            <li>Frame absorption: Adopt frames without examining if they're yours</li>
                            <li>Frame fragmentation: Different roles use incompatible frames</li>
                            <li>Frame-reality mismatch: Frames don't match your capacities</li>
                            <li>Prospective incoherence: Can't imagine future that feels like "you"</li>
                        </ul>
                        <p><strong>Frame Solution for Meaning:</strong></p>
                        <ol>
                            <li>Frame examination: Which beliefs/values are mine vs. absorbed?</li>
                            <li>Frame alignment: Do actions match values?</li>
                            <li>Frame continuity: Does past make sense?</li>
                            <li>Frame projection: Can I imagine authentic future?</li>
                        </ol>
                    </div>
                `,
                therapy: `
                    <div class="example-box">
                        <h3>üß† Therapy & Healing: Frame Reconstruction</h3>
                        <p><strong>Reframe Therapy As:</strong> Fundamentally about frame examination and reconstruction.</p>
                        <p><strong>Examples:</strong></p>
                        <ul>
                            <li>CBT: Identifying dysfunctional frames, reconstructing functional ones</li>
                            <li>Trauma therapy: Integrating fragmentary frames into coherent narrative</li>
                            <li>Narrative therapy: Reconstructing life story using different frames</li>
                            <li>Mindfulness: Observing frames without identifying with them</li>
                            <li>Psychedelic therapy: Temporary destabilization enabling reconstruction</li>
                        </ul>
                        <p><strong>The Insight:</strong> Most suffering involves rigid frames (low Meta-Constructor) 
                        or fragmented frames (low ATCF). Treatment = frame development.</p>
                    </div>
                `
            };

            details.innerHTML = content[type] || '';
            details.style.display = 'block';
            details.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function saveStartingPractice() {
            const select = document.getElementById('startingPractice');
            const commitment = document.getElementById('practiceCommitment');
            
            if (select.value) {
                state.userNotes.startingPractice = select.value;
                saveState();
                
                const practiceNames = {
                    morning: 'Morning Frame-Setting',
                    moment: 'Moment-to-Moment Awareness',
                    evening: 'Evening Review',
                    weekly: 'Weekly Frame Journal',
                    mindfulness: 'Mindfulness Meditation',
                    perspective: 'Perspective-Taking',
                    future: 'Future Self-Visualization'
                };
                
                commitment.innerHTML = `
                    <div class="example-box">
                        <h4>‚úì Your Commitment</h4>
                        <p><strong>${practiceNames[select.value]}</strong></p>
                        <p>You've committed to practicing this for 2 weeks starting today.</p>
                        <p>Set a reminder now and mark it in your calendar!</p>
                    </div>
                `;
                commitment.style.display = 'block';
                updateSubmissionStatus();
            }
        }

        function updateSubmissionStatus() {
            const sectionsEl = document.getElementById('sectionsCompleted');
            const atcfEl = document.getElementById('atcfStatus');
            const metaEl = document.getElementById('metaStatus');
            
            if (sectionsEl) sectionsEl.textContent = `${state.completedSections.size}/8`;
            if (atcfEl) atcfEl.textContent = state.quizScores.atcf ? '‚úì Completed' : 'Not completed';
            if (metaEl) metaEl.textContent = state.quizScores.metaConstructor ? '‚úì Completed' : 'Not completed';
        }

        // ============================================
        // PDF AND EXPORT FUNCTIONS
        // ============================================

        function viewPDF() {
            const modal = document.getElementById('pdfModal');
            const viewer = document.getElementById('pdfViewer');
            viewer.src = PDF_FILE_PATH;
            modal.style.display = 'block';
        }

        function downloadPDF() {
            const link = document.createElement('a');
            link.href = PDF_FILE_PATH;
            link.download = 'Reference_Frames_Essay.pdf';
            link.click();
        }

        function showExportModal() {
            const modal = document.getElementById('exportModal');
            modal.style.display = 'block';
            updateSubmissionStatus();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        function generateFormattedSubmission() {
            const date = new Date().toLocaleDateString();
            let studentName = prompt('Enter your name:', '');
            if (!studentName || studentName.trim() === '') {
                studentName = '[YOUR NAME HERE]';
            }
            
            let submission = `
================================================================================
REFERENCE FRAMES LEARNING JOURNEY - ASSIGNMENT SUBMISSION
================================================================================

Student Name: ${studentName}
Date Completed: ${date}
Course: [COURSE NAME/NUMBER]
Instructor: [INSTRUCTOR NAME]

Sections Completed: ${state.completedSections.size} of ${sections.length}
Completion Status: ${state.completedSections.size === sections.length ? 'COMPLETE ‚úì' : 'INCOMPLETE'}

================================================================================
PART 1: SELF-ASSESSMENTS
================================================================================

`;

            // ATCF scores
            if (state.quizScores.atcf) {
                const { total, avg, scores } = state.quizScores.atcf;
                const components = [
                    'Historical Continuity',
                    'Present Integration',
                    'Prospective Coherence',
                    'Meta-Constructor Capacity'
                ];
                
                submission += `ATCF (Adaptive Temporal Coherence Function) Assessment
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Total Score: ${total}/40 (Average: ${avg.toFixed(1)}/10)

Component Breakdown:
`;
                components.forEach((comp, i) => {
                    submission += `  ‚Ä¢ ${comp}: ${scores[i]}/10\n`;
                });
                submission += '\n';
            } else {
                submission += 'ATCF Assessment: NOT COMPLETED\n\n';
            }

            // Meta-Constructor scores
            if (state.quizScores.metaConstructor) {
                const { total, avg, scores } = state.quizScores.metaConstructor;
                submission += `Meta-Constructor Capacity Assessment
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Total Score: ${total}/50 (Average: ${avg.toFixed(1)}/10)

Component Breakdown:
  ‚Ä¢ Observe frames: ${scores[0]}/10
  ‚Ä¢ Question frames: ${scores[1]}/10
  ‚Ä¢ Imagine alternatives: ${scores[2]}/10
  ‚Ä¢ Modify deliberately: ${scores[3]}/10
  ‚Ä¢ Maintain coherence: ${scores[4]}/10

`;
            } else {
                submission += 'Meta-Constructor Assessment: NOT COMPLETED\n\n';
            }

            submission += `
================================================================================
PART 2: REFLECTIONS AND EXERCISES
================================================================================

`;

            // Reflections
            const exercises = {
                'frameExercise1': 'Frame Recognition Exercise (Section 2: What Are Reference Frames?)',
                'scaleReflection': 'Cross-Scale Misalignment Reflection (Section 3: Scale Hierarchy)',
                'problemAnalysis': 'Problem Frame Analysis (Section 6: Applications)',
                'startingPractice': 'Selected Starting Practice (Section 7: Personal Practice)'
            };

            Object.entries(exercises).forEach(([key, title]) => {
                submission += `${title}\n${'-'.repeat(title.length)}\n`;
                if (state.userNotes[key]) {
                    submission += `${state.userNotes[key]}\n\n`;
                } else {
                    submission += '[NOT COMPLETED]\n\n';
                }
            });

            submission += `
================================================================================
PART 3: COMPLETION SUMMARY
================================================================================

Modules Completed:
`;

            sections.forEach((section, index) => {
                const completed = state.completedSections.has(index) ? '‚úì' : '‚óã';
                submission += `${completed} ${section.title}\n`;
            });

            submission += `
================================================================================
INSTRUCTOR NOTES
================================================================================

This submission represents completion of the Reference Frames interactive 
learning journey, including:

- Self-assessment scores for ATCF and Meta-Constructor Capacity
- Written reflections from all interactive exercises
- Selected development priority and practice commitment  
- Record of completed learning modules
- Engagement with the complete essay (PDF)

Student has worked through all ${sections.length} sections of the interactive platform
and completed the requirements as indicated above.

For questions about this assignment, please contact the student.

================================================================================
END OF SUBMISSION
================================================================================

Generated: ${new Date().toLocaleString()}
Platform: Reference Frames Interactive Learning Journey
Based on: "Reference Frames: A Unified Lens for Understanding and 
          Transforming Human Systems"
`;

            return submission;
        }

        function exportFormatted() {
            const formatted = generateFormattedSubmission();
            
            // Copy to clipboard
            const textarea = document.createElement('textarea');
            textarea.value = formatted;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            // Show preview
            document.getElementById('previewContent').textContent = formatted;
            document.getElementById('exportPreview').style.display = 'block';
            
            // Show notification
            showCopyNotification();
            
            alert('‚úÖ Your assignment has been copied to clipboard!\n\nYou can now:\n‚Ä¢ Paste into an email to your instructor\n‚Ä¢ Paste into your LMS text box\n‚Ä¢ Paste into a Word document\n\nA preview is shown below.');
        }

        function exportDocument() {
            const formatted = generateFormattedSubmission();
            const blob = new Blob([formatted], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const date = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `Reference-Frames-Assignment-${date}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Your assignment has been downloaded!\n\nThe file can be:\n‚Ä¢ Opened in Word/Google Docs for formatting\n‚Ä¢ Submitted directly as a text file\n‚Ä¢ Copied and pasted as needed');
        }

        function exportJSON() {
            const data = {
                studentName: prompt('Enter your name for the file:', '') || 'Student',
                completedSections: Array.from(state.completedSections),
                quizScores: state.quizScores,
                userNotes: state.userNotes,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const date = new Date().toISOString().split('T')[0];
            a.href = url;
            a.download = `reference-frames-backup-${date}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Backup file downloaded!\n\nThis JSON file contains all your data and can be used as a backup.');
        }

        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialize on page load
        window.onload = initApp;
    </script>
</body>
</html>
